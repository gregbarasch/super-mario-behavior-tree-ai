<?xml version="1.0" encoding="UTF-8" ?>

<sequence>

    <!-- Move left or right -->
    <selector>
        <!-- Movement Locked? (Happens when were still processing previous movements) -->
        <sequence>
            <movementlocked/>
            <decrementmovementlock/>
        </sequence>
        <!-- running out of time, move right. -->
        <sequence>
            <timerunningout tolerance="20"/>
            <move>right</move>
        </sequence>
        <!-- wasting time? Let's make some progress -->
        <sequence>
            <wastingtime tolerance="8"/>
            <move>right</move>
        </sequence>
        <!-- Go back to grab coin? -->
        <sequence>
            <coinnear left="5" up="3" down="3"/>
            <move>left</move>
            <setmovementlock ticks="15"/>
        </sequence>
        <!-- Missed a stompable enemy? -->
        <sequence>
            <enemynear left="4" down="3" stompable="true"/>
            <move>left</move>
            <setmovementlock ticks="15"/>
        </sequence>
        <!-- avoid enemy ahead? -->
        <sequence>
            <enemyahead distance="2" up="4"/>
            <move>reverse</move>
        </sequence>
        <!-- otherwise move right. -->
        <move>right</move>
    </selector>

    <!-- Nonstop fireballs -->
    <selector>
        <sequence>
            <canshoot/>
            <shoot/>
        </sequence>
        <shootcomplete/>
    </selector>

    <!--  Land or jump  -->
    <selector>
        <!-- Land -->
        <sequence>
            <isjumpfinished/>
            <land/>
        </sequence>

        <!-- Jump -->
        <sequence>
            <canjump/>

            <selector>
                <!-- do a stomp -->
                <sequence>
                    <enemyahead distance="4" down="3" stompable="true"/>
                    <jump/>
                </sequence>
                <!-- jump over the enemy -->
                <sequence>
                    <enemyahead distance="2"/>
                    <jump/>
                </sequence>
                <!-- jump to a coin -->
                <sequence>
                    <coinahead up="5"/>
                    <jump/>
                </sequence>
                <!-- jump over the blocker -->
                <sequence>
                    <wallahead distance="2" up="1"/>
                    <jump/>
                </sequence>
            </selector>
        </sequence>

    </selector>

</sequence>
